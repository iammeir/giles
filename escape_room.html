<!--save as html file-->
<html  dir="auto" >
<head>
<link rel="icon"
      type="image/png"
      href="favicon.png">
<title>Obfuscated Lever Mechanism</title>
<style>
	body {
		margin:40px;
		padding:40px;
    background: #000000;
    color: #888888;
    font-family: sans-serif;
    font-size: 40px;
	}

  a {
  color: #000000;
  text-shadow: 0px 1px #888888;
  text-decoration: none;
  }

  h2 {
    color: #000000;
    text-shadow: 0px 1px #888888;
    text-decoration: none;
  }
</style>
<script>

var embedDat = "%7B%22START%22:%5B%5B%22%5C%22Obfuscated%20Lever%20Mechanism%5C%22%20was%20the%20Title%20on%20the%20door.%22%5D,%5B%22You%20can't%20read%20that%20now%20though:%20too%20dark,%20and%20it's%20mounted%20outside%20the%20room%20you've%20locked%20yourself%20in.%22%5D,%5B%22%22%5D,%5B%22Better%20have%20a%20look%20around%22,%22ROOM_1%22%5D,%5B%22%22%5D%5D,%22__STARTSECTION__%22:%22START%22,%22ROOM_1%22:%5B%5B%22The%20light%20squeezing%20in%20around%20the%20doorframe%20just%20illuminates%20the%20outline%20of%20two%20reflective%20objects.%22%5D,%5B%22On%20the%20wall%20is%20a%20large%20gilt%20edged%20frame,%20with%20what%20you%20presume%20is%20a%20picture%20inside%22%5D,%5B%22%22%5D,%5B%22Underneath%20it%20at%20waist%20height,%20is%20a%20brass%20handle,%20projected%20away%20from%20you.%20It's%20a%20two%20handed%20affair.%22%5D,%5B%22%22%5D,%5B%22I%20inspect%20the%20painting%22,%22ART_1%22%5D,%5B%22%22%5D,%5B%22I%20reach%20for%20the%20lever%22,%22LEVER_1%22%5D,%5B%22%22%5D,%5B%22I%20try%20the%20door%20again%22,%22DOOR_1%22%5D,%5B%22%22%5D%5D,%22DOOR_1%22:%5B%5B%22You%20yell,%20shout,%20kick%20and%20pull%20at%20the%20door.%20You%20use%20a%20card%20from%20your%20wallet%20to%20try%20and%20slip%20the%20latch%20but%20you%20lose%20your%20grip%20and%20it%20falls%20onto%20the%20growing%20pile%20of%20your%20cards%20in%20the%20hallway.%22%5D,%5B%22At%20this%20point%20it's%20a%20practical%20starter%20pack%20for%20identity%20theft.%22%5D,%5B%22%22%5D,%5B%22I%20turn%20my%20attention%20back%20to%20the%20room%22,%22ROOM_1%22%5D,%5B%22%22%5D%5D,%22ART_1%22:%5B%5B%22It's%20not%20clear%20what%20you%20were%20hoping%20to%20learn%20by%20touching%20the%20painting,%20but%20a%20glass%20pane%20covers%20it.%20Of%20course.%22%5D,%5B%22%22%5D,%5B%22I%20step%20away%20from%20the%20painting%22,%22ROOM_1%22%5D,%5B%22%22%5D%5D,%22LEVER_1%22:%5B%5B%22Sweet%20meats%20this%20thing's%20heavier%20than%20I%20thought%22%5D,%5B%22%22%5D,%5B%22Take%20a%20breather%22,%22ROOM_1%22%5D,%5B%22%22%5D,%5B%22Put%20your%20back%20into%20it%22,%22LEVER_1_2%22%5D,%5B%22%22%5D%5D,%22LEVER_1_2%22:%5B%5B%22With%20a%20timbrous%20KER-THUNK,%20so%20satisfying%20you'd%20swear%20it%20was%20a%20prop%20in%20a%20video%20game,%20the%20lever%20falls%20towards%20you%20and%20stops.%20You've%20completely%20put%20your%20back%20out%20though.%22%5D,%5B%22%22%5D,%5B%22Has%20anything%20changed?%22,%22ROOM_2%22%5D,%5B%22%22%5D%5D,%22ROOM_2%22:%5B%5B%22The%20light%20squeezing%20in%20around%20the%20doorframe%20just%20illuminates%20the%20outline%20of%20two%20reflective%20objects.%22%5D,%5B%22On%20the%20wall%20is%20a%20large%20gilt%20edged%20frame,%20with%20what%20you%20presume%20is%20a%20picture%20inside%22%5D,%5B%22%22%5D,%5B%22Underneath%20it%20at%20waist%20height,%20is%20a%20brass%20handle,%20projected%20towards%20you.%20It's%20staying%20that%20way.%22%5D,%5B%22%22%5D,%5B%22I%20inspect%20the%20painting%22,%22ART_2%22%5D,%5B%22%22%5D,%5B%22I%20reach%20for%20the%20lever%22,%22LEVER_2%22%5D,%5B%22%22%5D,%5B%22I%20try%20the%20door%20again%22,%22DOOR_2%22%5D,%5B%22%22%5D%5D,%22LEVER_2%22:%5B%5B%22No%20you%20don't%22%5D,%5B%22%22%5D,%5B%22No%20I%20don't%22,%22ROOM_2%22%5D,%5B%22%22%5D%5D,%22DOOR_2%22:%5B%5B%22You%20yell,%20shout,%20kick%20and%20pull%20at%20the%20door.%20You%20use%20a%20card%20from%20your%20wallet%20to%20try%20and%20slip%20the%20latch%20but%20you%20lose%20your%20grip%20and%20it%20falls%20onto%20the%20growing%20pile%20of%20your%20cards%20in%20the%20hallway.%22%5D,%5B%22At%20this%20point%20it's%20a%20practical%20starter%20pack%20for%20identity%20theft.%22%5D,%5B%22%22%5D,%5B%22I%20turn%20my%20attention%20back%20to%20the%20room%22,%22ROOM_2%22%5D,%5B%22%22%5D%5D,%22ART_2%22:%5B%5B%22Ah!%20the%20glass%20is%20gone!%22%5D,%5B%22It's%20a%20wooden%20carving,%20something%20rotary,%20and%20there's%20some%20give%20towards...%22%5D,%5B%22aw%20man%20it's%20another%20lever.%22%5D,%5B%22%22%5D,%5B%22Screw%20this%22,%22ROOM_2%22%5D,%5B%22%22%5D,%5B%22I%20want%20out%20I'll%20try%20anything%22,%22ART_2_2%22%5D,%5B%22%22%5D%5D,%22ART_2_2%22:%5B%5B%22Another%20fantastically%20tactile%20mechanism,%20it%20moves%20much%20easier%20this%20time.%20You%20take%20it%20through%20a%20full%20rotation%20before%20it%20locks%20in%20place.%22%5D,%5B%22You%20hear%20a%20series%20of%20delocalised%20percussive%20clicks.%20Some%20arcane,%20intractable%20mechanism.%22%5D,%5B%22%22%5D,%5B%22I%20return%20to%20the%20room%22,%22ROOM_3%22%5D,%5B%22%22%5D%5D,%22ROOM_3%22:%5B%5B%22The%20light%20squeezing%20in%20around%20the%20doorframe%20just%20illuminates%20the%20outline%20of%20two%20reflective%20objects.%22%5D,%5B%22On%20the%20wall%20is%20a%20large%20gilt%20edged%20frame,%20with%20what%20you%20presume%20is%20a%20picture%20inside%22%5D,%5B%22%22%5D,%5B%22Underneath%20it%20at%20waist%20height,%20is%20a%20brass%20handle,%20projected%20towards%20you.%20It's%20staying%20there.%22%5D,%5B%22%22%5D,%5B%22I%20try%20the%20lever%20in%20the%20frame%20again%22,%22ART_3%22%5D,%5B%22%22%5D,%5B%22I%20check%20on%20that%20first%20big%20lever%22,%22LEVER_3%22%5D,%5B%22%22%5D,%5B%22I'm%20willing%20to%20try%20the%20door%20again%22,%22END%22%5D,%5B%22%22%5D%5D,%22ART_3%22:%5B%5B%22After%20locking%20back%20in%20the%20lever%20has%20receded%20into%20the%20carving.%20Feels%20like%20a%20nice%20piece.%20Shame%20you%20can't%20see%20it.%22%5D,%5B%22%22%5D,%5B%22I%20return%20to%20the%20room%22,%22ROOM_3%22%5D%5D,%22LEVER_3%22:%5B%5B%22Your%20back%20is%20not%20up%20to%20moving%20it%20again.%22%5D,%5B%22%22%5D,%5B%22I%20return%20to%20the%20room%22,%22ROOM_3%22%5D,%5B%22%22%5D%5D,%22END%22:%5B%5B%22It%20opens!%20Sweet%20meat%20it%20opens!%22%5D,%5B%22You%20scoop%20up%20your%20pile%20of%20identifiable%20information%20and%20get%20back%20to%20your%20desk%20in%20the%20office%20of%20contrived%20escape%20puzzles.%22%5D,%5B%22%22%5D%5D%7D";

var gameState = null;


var aurl = document.createElement('a');
function qualifyURL(url) {
 aurl.href = url;
 return aurl.href;
}

function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

function strip_http(url) {
   url = url.replace(/^https?:\/\//,'');
   return url;
}

function startSection(){
  if (gameState==null){
    return "";
  }
  var param = getParameterByName("section");

  var result = "__STARTSECTION__" in gameState ? gameState["__STARTSECTION__"] : "START";
  if (param.length>0){
    result=param;
  }

  return result;
}

function init(){
	if (embedDat.length>0 && embedDat[0]!=='_'){
		var dat = decodeURI(embedDat);
		gameState = JSON.parse(dat);
    var startKey = startSection();
		goTo(startKey);
		return;
	}

var id = getParameterByName("p").replace(/[\\\/]/,"");
  if (id===null||id.length===0) {
    console.log("No ID specified in URL.")
    return;
  }

  var githubURL = 'https://api.github.com/gists/'+id;

  var githubHTTPClient = new XMLHttpRequest();
  githubHTTPClient.open('GET', githubURL);
  githubHTTPClient.onreadystatechange = function() {
    if(githubHTTPClient.readyState!=4) {
      return;
    }
    var result = JSON.parse(githubHTTPClient.responseText);
    if (githubHTTPClient.status===403) {
      console.log(result.message);
    } else if (githubHTTPClient.status!==200&&githubHTTPClient.status!==201) {
      console.log("HTTP Error "+ githubHTTPClient.status + ' - ' + githubHTTPClient.statusText);
    }
    var result = JSON.parse(githubHTTPClient.responseText);
    var code=result["files"]["game.txt"]["content"];
    console.log(code);

	gameState = JSON.parse(code);
	goTo(startSection());
  }
  githubHTTPClient.setRequestHeader("Content-type","application/x-www-form-urlencoded");
  githubHTTPClient.send();

	goTo(startSection());
}

function escapeHtmlEntities (str) {
  if (typeof jQuery !== 'undefined') {
    // Create an empty div to use as a container,
    // then put the raw text in and get the HTML
    // equivalent out.
    return jQuery('<div/>').text(str).html();
  }

  // No jQuery, so use string replace.
  return str
    .replace(/&/g, '&amp;')
    .replace(/>/g, '&gt;')
    .replace(/</g, '&lt;')
    .replace(/"/g, '&quot;');
}

function goTo(targetState){
  if (gameState==null){
    return;
  }
	var curstate = gameState[targetState];
	var gameArea = document.getElementById("gameArea");
	var str = "";
	for (var i=0;i<curstate.length;i++){
		var l = curstate[i];
		if (l.length==1){
			str+=escapeHtmlEntities(l[0])+"<br>";
		} else if (l.length==2){
			str+='<a href="#" onclick="goTo(\''+escapeHtmlEntities(l[1])+'\');return false;">'+escapeHtmlEntities(l[0])+'</a><br>';
		}
	}
	gameArea.innerHTML=str;
}

</script>
</head>
<body onload="init();" dir="auto">
<h2> Obfuscated Lever Mechanism </h2>
<div id="gameArea" dir="auto"></div>
</body>
</html>
